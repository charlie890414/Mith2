"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var CryptoJS=_interopDefault(require("crypto-js")),axios=_interopDefault(require("axios"));function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _uuid(){var n=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===t?e:3&e|8).toString(16)})}function _sendAPI(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"GET",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{headers:null,data:null,params:null},a=n.params||n.data||{},i=n.headers||{};if("client_id"in a){var o=_generateSignature(a,CryptoJS.enc.Hex.parse(this.clientSecert));i["X-Vault-Signature"]=o}var r="".concat(this.api,"/").concat(t);try{return axios({method:e,url:r,params:n.params,data:n.data,headers:i}).then(function(t){return t.data}).catch(function(t){throw t})}catch(t){throw t}}function _generateSignature(t,e){var n="";if(t&&Array.isArray(t))n=t.join(",");else if(t){var a=_sortObject(t);n=Object.keys(a).map(function(t){return"".concat(t,"=").concat(a[t])}).join("&")}else t&&(n=t.toString());var i=CryptoJS.HmacSHA512(n,e);return CryptoJS.enc.Hex.stringify(i)}function _sortObject(n){return Object.keys(n).sort().reduce(function(t,e){return t[e]=n[e],t},{})}function _randomInt(){return Math.floor(1e17*Math.random())}var MithVaultSDK=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.clientId,n=t.clientSecret,a=t.miningKey;_classCallCheck(this,i),this.host="https://2019-hackathon.mithvault.io",this.api="https://2019-hackathon.api.mithvault.io",this.authorize="/#/oauth/authorize",this.donate="/#/donate",this.clientId=e,this.clientSecert=n,this.miningKey=a}return _createClass(i,[{key:"getBindURI",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:_uuid(),e={client_id:this.clientId,state:t},n=Object.keys(e).map(function(t){return"".concat(t,"=").concat(e[t])}).join("&");return"".concat(this.host).concat(this.authorize,"?").concat(n)}},{key:"getDonateURI",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e={app_id:t.appID,user_id:t.userID,amount:t.amount,state:t.state,desc:t.description},n=Object.keys(e).map(function(t){return"".concat(t,"=").concat(e[t])}).join("&");return"".concat(this.host).concat(this.donate,"?").concat(n)}},{key:"getAccessToken",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.grantCode,n=t.state,a={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt(),grant_code:e,state:n};return _sendAPI.call(this,"oauth/token","POST",{data:a})}},{key:"delUnbindToken",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).token,e={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt()},n={Authorization:t};return _sendAPI.call(this,"oauth/token","DELETE",{headers:n,params:e})}},{key:"getClientInformation",value:function(){var t={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt()};return _sendAPI.call(this,"oauth/balance","GET",{params:t})}},{key:"getUserInformation",value:function(t){var e={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt()},n={Authorization:t};return _sendAPI.call(this,"oauth/user-info","GET",{headers:n,params:e})}},{key:"getUserMiningAction",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.token,n=t.nextId,a=void 0===n?null:n,i={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt(),mining_key:this.miningKey},o={Authorization:e};return a&&(i.next_id=a),_sendAPI.call(this,"mining","GET",{headers:o,params:i})}},{key:"postUserMiningAction",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.token,n=t.uuid,a=void 0===n?_uuid():n,i=t.reward,o=void 0===i?1:i,r=t.happenedAt,c=void 0===r?null:r,u=new Date,s=function(t){return t.toString().padStart(2,0)},l={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt(),mining_key:this.miningKey,uuid:a,reward:o,happened_at:c||"".concat(u.getUTCFullYear(),"-").concat(s(u.getUTCMonth()),"-").concat(s(u.getUTCDate()),"T").concat(s(u.getUTCHours()),":").concat(s(u.getUTCMinutes()),":").concat(s(u.getUTCSeconds()))},d={Authorization:e};return _sendAPI.call(this,"mining","POST",{headers:d,data:l})}},{key:"deleteUserMiningAction",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.token,n=t.uuid,a={client_id:this.clientId,timestamp:Math.floor(Date.now()/1e3),nonce:_randomInt(),mining_key:this.miningKey,uuid:n||_uuid()},i={Authorization:e};return _sendAPI.call(this,"mining","DELETE",{headers:i,params:a})}}]),i}();module.exports=MithVaultSDK;
